<!DOCTYPE html>
<!--
/*
 * INTER-Mediator Ver.@@@@2@@@@ Released @@@@1@@@@
 *
 *   by Masayuki Nii  msyk@msyk.net Copyright (c) 2014 Masayuki Nii, All rights reserved.
 *
 *   This project started at the end of 2009.
 *   INTER-Mediator is supplied under MIT License.
 */  -->

<html>
<head>
    <title>INTER-Mediator - Sample - Form Style/MySQL</title>
    <meta http-equiv="content-type" content="text/html;charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <link rel="stylesheet" type="text/css" href="../sample.css"/>
    <script type="text/javascript" src="search_def.php"></script>
    <script type="text/javascript">
        window.onload = function () {
            IMLibKeyEventDispatch.setExecute('condition', 13, function () {
                IMLibLocalContext.update('condition');
                doSearch();
            });
            IMLibMouseEventDispatch.setExecute('search', function () {
                doSearch();
            });
            IMLibMouseEventDispatch.setExecute('sort1a', function () {
                INTERMediator.additionalSortKey = {"postalcode": {field: 'f3', direction: 'ASC'}};
                doSearch();
            });
            IMLibMouseEventDispatch.setExecute('sort1d', function () {
                INTERMediator.additionalSortKey = {"postalcode": {field: 'f3', direction: 'DESC'}};
                doSearch();
            });
            IMLibMouseEventDispatch.setExecute('sort2a', function () {
                INTERMediator.additionalSortKey = {"postalcode": {field: 'f9', direction: 'ASC'}};
                doSearch();
            });
            IMLibMouseEventDispatch.setExecute('sort2d', function () {
                INTERMediator.additionalSortKey = {"postalcode": {field: 'f9', direction: 'DESC'}};
                doSearch();
            });
            INTERMediator.construct(true);
        };
        function doSearch() {
            INTERMediator.additionalCondition = {};
            var c1 = IMLibLocalContext.getValue("condition");
            if (c1 && c1.length > 0) {
                INTERMediator.additionalCondition = {"postalcode": [
                    {field: 'f3', operator: 'LIKE', value: '%' + c1 + '%'},
                    {field: 'f7', operator: 'LIKE', value: '%' + c1 + '%'},
                    {field: 'f8', operator: 'LIKE', value: '%' + c1 + '%'},
                    {field: 'f9', operator: 'LIKE', value: '%' + c1 + '%'},
                    {field: '__operation__', operator: 'ex'}
                ]};
            }
            INTERMediator.startFrom = 0;
            IMLibLocalContext.archive();    // This isn't required other than IE8.
            INTERMediator.construct(true);
        }
    </script>
</head>
<body>
<div>
    検索条件:
    <input type="text" id="condition" data-im="_@condition"/>
    <button id="search">search</button>
</div>
<div id="IM_NAVIGATOR">Navigation Controls by INTER-Mediator</div>
<table border="1" id="resultTable">
    <thead>
    <tr>
        <th>郵便番号
            <span id="sort1a" style="cursor:pointer">▲</span>
            <span id="sort1d" style="cursor:pointer">▼</span>
        </th>
        <th>都道府県</th>
        <th>市区町村</th>
        <th>町域名
            <span id="sort2a" style="cursor:pointer">▲</span>
            <span id="sort2d" style="cursor:pointer">▼</span>
        </th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td>
            <div data-im="postalcode@f3"></div>
        </td>
        <td>
            <div data-im="postalcode@f7"></div>
        </td>
        <td>
            <div data-im="postalcode@f8"></div>
        </td>
        <td>
            <div data-im="postalcode@f9"></div>
        </td>
    </tr>
    <tr data-im-control="noresult">
        <td colspan="4">検索結果はありません。あるいは検索前です。</td>
    </tr>
    </tbody>
</table>

</body>
</html>